package com.shw;
import java.io.File;
import java.io.IOException;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.select.Elements;
import jxl.Workbook;
import jxl.write.Label;
import jxl.write.WritableSheet;
import jxl.write.WritableWorkbook;

public class ExchangeRate {
	
	private static String[] date;
	private static String[] usdRate ;
	private static String[] euroRate;
	private static String[] hkdRate;

	static String[] execl = new String[] { "日期", "美元", "欧元", "港元" };
	public static void main(String[] args) {
		date = getDate("http://www.kuaiyilicai.com/huilv/d-boc-usd.html", 0);
		usdRate = getData("http://www.kuaiyilicai.com/huilv/d-boc-usd.html", usdRate);
		euroRate = getData("http://www.kuaiyilicai.com/huilv/d-boc-eur.html", euroRate);
		hkdRate = getData("http://www.kuaiyilicai.com/huilv/d-boc-hkd.html", hkdRate);
		insertExcel();

	}

	
	public static void insertData(WritableSheet ws, String[] rate, int index) {
		Label label;
		for (int i = 1; i < rate.length; i++) {
			label = new Label(index, i, rate[i]);
			try {
				ws.addCell(label);
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
	}


   //得到日期
	public static String[] getDate(String url, int index) {
		date = new String[32];
		try {
			Document doc = Jsoup.connect(url).get();
			Elements el = doc.select("table").select("tr");
			for (int i = 2; i < el.size(); i++) {
				Elements tds = el.get(i).select("td");
				date[i - 2] = tds.get(index).text();
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		return date;

	}

	public static String[] getData(String url, String[] rate) {
		rate = new String[32];
		try {
			Document data = Jsoup.connect(url).get();
			Elements el = data.select("table").select("tr");
			for (int i = 2; i < el.size(); i++) {
				Elements tds = el.get(i).select("td");
				rate[i - 2] = tds.get(5).text();
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		return rate;
	}

	
	//将数据插入execl中
	public static void insertExcel() {
		try {
			WritableWorkbook worbook = Workbook.createWorkbook(new File("E:/data.xlsx"));
			WritableSheet ws = worbook.createSheet("汇率", 0);
			Label label;
			for (int i = 0; i < execl.length; i++) {
				label = new Label(i, 0, execl[i]);
				ws.addCell(label);
			}
			
			//插入日期
			for (int i = 1; i < date.length; i++) {
				label = new Label(0, i, date[i]);
				ws.addCell(label);
			}
            //插入汇率
			insertData(ws, usdRate, 1);
			insertData(ws, euroRate, 2);
			insertData(ws, hkdRate, 3);
			worbook.write();
			worbook.close();
		} catch (Exception e) {

			e.printStackTrace();
		}
	}
}
